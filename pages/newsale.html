<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Fontenay</title>

    <!-- Bootstrap Core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/metisMenu/2.7.9/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        /* Mark input boxes that gets an error on validation: */
        input.invalid {
            background-color: #ffdddd;
        }

        /* Hide all steps by default: */
        .tab {
            display: none;
        }

        /* Make circles that indicate the steps of the form: */
        .step {
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbbbbb;
            border: none;
            border-radius: 50%;
            display: inline-block;
            opacity: 0.5;
        }

        /* Mark the active step: */
        .step.active {
            opacity: 1;
        }

        /* Mark the steps that are finished and valid: */
        .step.finish {
            background-color: #4CAF50;
        }
    </style>
</head>

<body>
    <div id="wrapper">
        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0; background-color: white">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-left" href="transactions.html"><img src="../dist/images/logo.png" style="height: 50px;"></a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right" style="display: none">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Read All Messages</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">40% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 2</strong>
                                        <span class="pull-right text-muted">20% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 3</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 4</strong>
                                        <span class="pull-right text-muted">80% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete (danger)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Tasks</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-tasks fa-fw"></i> New Task
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="nav navbar-nav navbar-right" style="">         <button type="button" class="btn btn-primary" onclick="_logout()" style="    padding: auto;    margin: 8px 30px;"><span class="glyphicon glyphicon-log-out"></span>  Cerrar sesión</button>      </div><div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="forbidden">
                            <a href="transactions.html"><i class="fa fa-table fa-fw"></i> Movimientos</a>
                        </li>
                        <li class="forbidden">
                            <a href="sales.html"><i class="fa fa-table fa-fw"></i> Ventas</a>
                        </li>
                        <li>
                            <a href="newsale.html"><i class="fa fa-edit fa-fw"></i> Nueva venta</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-wrench fa-fw"></i> Configuración<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level collapse">
                                <li class="forbidden">
                                    <a href="exchange-rate.html">Cotización divisas</a>
                                </li>
                                <li>
                                    <a href="products.html">Productos</a>
                                </li>
                                <li class="forbidden">
                                    <a href="providers.html">Proveedores</a>
                                </li>
                            </ul>
                        </li>
                        <li style="display:none;">
                            <a href="login.html"><i class="fa fa-files-o fa-fw"></i> Login</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-bar-chart-o fa-fw"></i> Reportes<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level collapse">
                                <li id="reportseller" class="forbidden">
                                    <a href="reportseller.html">Comisión vendedores</a>
                                </li>
                                <li id="reportpromoter" class="forbidden">
                                    <a href="reportpromoter.html">Comisión promotores</a>
                                </li>
                                <li class="forbidden">
                                    <a href="reportprovider.html">Pagos pendientes</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 ">
                    <form id="regForm" role="form" action="">
                        <!-- One "tab" for each step in the form: -->
                        <div class="tab" class="form-group">
                            <h2>Datos del cliente</h2>
                            <div class="form-group col-xs-12 col-sm-12 col-md-6 col-lg-4">
                                <label>Nombre y Apellido</label>
                                <input class="form-control" id="clientname" value="">
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-4">
                                <label>Nacionalidad</label>
                                <input class="form-control" id="nationality" value="">
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-4">
                                <label>Email</label>
                                <input class="form-control" id="email" value="">
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-4">
                                <label>Promotor</label>
                                <select class="form-control" id="promotersel">
                                </select>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-4">
                                <label>DNI/Pasaporte</label>
                                <input class="form-control no-required" id="passport" value="" >
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-4">
                                <label>Hotel</label>
                                <input class="form-control no-required" id="hotel" value="">
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-4">
                                <label>Dirección</label>
                                <input class="form-control no-required" id="address" value="">
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-4">
                                <label>Habitación</label>
                                <input class="form-control no-required" id="room" value="">
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-4">
                                <label>Número de contacto</label>
                                <input class="form-control no-required" id="phonenumber" value="">
                            </div>
                        </div>

                        <div class="tab" class="form-group">
                            <h2>Productos</h2>
                            <div class="row">
                                <div class="form-group col-xs-6 col-sm-6 col-md-4 col-lg-2">
                                    <button id="addProduct" type="button" class="btn btn-success">
                                        Agregar producto  <span class="glyphicon glyphicon-plus"></span>
                                    </button>
                                </div>
                            </div>
                            <div id="listOfProducts" class="row">
                                <div id="product-1" class="productPanel col-xs-12 col-sm-12 col-md-6 col-lg-4">
                                    <div class="panel panel-default" >
                                        <div class="panel-heading">
                                            Producto
                                            <button type="button" class="close deleteProduct">×</button>
                                        </div>
                                        <div class="panel-body">
                                            <div class="form-group">
                                                <label>Proveedor</label>
                                                <select class="form-control" id="providerSel"></select>
                                            </div>
                                            <div class="form-group">
                                                <label>Servicio</label>
                                                <select class="form-control" id="servicesel"></select>
                                            </div>
                                            <div class="form-group">
                                                <label>Fecha/Hora pick-up (Si aplica)</label>
                                                <input class="form-control" id="date" type="datetime-local" value="" step="300">
                                            </div>
                                            <div class="form-group">
                                                <label>Traslado</label>
                                                <select class="form-control" id="transfersel">
                                                    <option value="true">Sí</option>
                                                    <option value="false">No</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Adulto(s)</label>
                                                <input id="adults" class="form-control" type="number" name="quantity" value="2" min="0">
                                            </div>
                                            <div class="form-group">
                                                <label>Niño(s)</label>
                                                <input id="children" class="form-control" type="number" name="quantity" value="0" min="0">
                                            </div>
                                            <div class="form-group">
                                                <label>Bebé(s)</label>
                                                <input id="babies" class="form-control" type="number" name="quantity" value="0" min="0">
                                            </div>
                                            <div class="form-group">
                                                <label>Subtotal producto</label>
                                                <div class=" input-group">
                                                    <span class="input-group-addon">$</span>
                                                    <input id="uprice" class="form-control" type="number" name="quantity" min="0" disabled>
                                                    <span class="input-group-addon">.00</span>
                                                </div>
                                            </div>
                                            <input id="stockprice" class="form-control-static" type="number" style="display: none">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab" class="form-group">
                            <h2>Confirmación</h2>
                            <h4>Datos del cliente</h4>
                            <div class="row">
                                <div class="form-group col-xs-12 col-sm-12 col-md-6 col-lg-3">
                                    <label>Nombre y Apellido</label>
                                    <p class="clientnamelabel form-control-static"></p>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label>Nacionalidad</label>
                                    <p class="nationalitylabel form-control-static"></p>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label>Email</label>
                                    <p class="emaillabel form-control-static"></p>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3 ">
                                    <label>Promotor</label>
                                    <p class="promoterlabel form-control-static"></p>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label>DNI/Pasaporte</label>
                                    <p class="passportlabel form-control-static"></p>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label>Hotel</label>
                                    <p class="hotellabel form-control-static"></p>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label>Dirección</label>
                                    <p class="addresslabel form-control-static"></p>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label>Habitación</label>
                                    <p class="roomlabel form-control-static"></p>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label>Número de contacto</label>
                                    <p class="phonelabel form-control-static"></p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-xs-6 col-sm-6 col-md-3 col-lg-2">
                                    <label>Subtotal</label>
                                    <div class="form-control-static">
                                        <div style="float: left;">AR$</div>
                                        <div class="productTotal" style="float: left;"></div>
                                        <div>.00</div>
                                    </div>
                                </div>
                                <!--<div class="form-group col-xs-12 col-sm-12 col-md-6 col-lg-3">-->
                                <!--<label>Vendedor</label>-->
                                <!--<p id="sellerconf" class="form-control-static"></p>-->
                                <!--</div>-->
                                <div class="form-group col-xs-6 col-sm-6 col-md-3 col-lg-2">
                                    <label>Moneda descuento</label>
                                    <select class="form-control" id="discountcurrencysel">
                                        <option value="dollarstr" curr="USD">Dólar</option>
                                        <option value="realstr" curr="BRL">Real</option>
                                        <option value="realtstr" curr="BRT">Real T.</option>
                                        <option value="eurostr" curr="EUR">Euro</option>
                                        <option value="pesostr" curr="ARS">Peso</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-xs-6 col-sm-6 col-md-3 col-lg-3">
                                    <label>Cotización</label>
                                    <div class=" input-group">
                                        <span class="input-group-addon">AR$</span>
                                        <input id="exchangeRate" class="form-control exchangeRate" step="0.1" type="number" name="quantity" min="0" disabled="">
                                        <span class="input-group-btn">
                                            <button class="btn btn-default" type="button" onclick="_enableEdit(event)"><i class="fa fa-edit"></i></button>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-3 col-lg-3">
                                    <label>Subtotal convertido</label>
                                    <div class=" input-group">
                                        <span class="input-group-addon" id="subtotalDiscountLabel">US$</span>
                                        <input id="subtotalDiscount" class="form-control" type="number" name="quantity" min="0" step="0.01" disabled>
                                    </div>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-3 col-lg-3">
                                    <label>Descuento</label>
                                    <div class="input-group">
                                        <span class="input-group-addon" id="discountLabel">US$</span>
                                        <input id="discount" class="form-control" disabled value="0" step="0.1" type="number" name="quantity" min="0">
                                    </div>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-3 col-lg-3">
                                    <label>Total a cobrar</label>
                                    <div class=" input-group">
                                        <span class="input-group-addon" id="totalDiscountLabel">US$</span>
                                        <input id="totalDiscount" class="form-control" value="0" type="number" name="quantity" min="0" step="0.01">
                                    </div>
                                </div>
                            </div>
                            <tr id="dollarstr" class="currtr">
                                    <td class="subtotalColumn ">
                                    </td>
                                    <td class="">
                                    </td>
                                    <td class="totalColumn ">
                                    </td>
                                </tr>
                                <tr id="realstr" style="display: none;" class="currtr">
                                    <td class="">
                                    </td>
                                    <td class="subtotalColumn ">
                                    </td>
                                    <td class="">

                                    </td>
                                    <td class="totalColumn ">

                                    </td>
                                </tr>
                                <tr id="realtstr" style="display: none;" class="currtr">
                                    <td class="">
                                    </td>
                                    <td class="subtotalColumn ">
                                    </td>
                                    <td class="">

                                    </td>
                                    <td class="totalColumn ">

                                    </td>
                                </tr>
                                <tr id="eurostr" style="display: none;" class="currtr">
                                    <td class="">

                                    </td>
                                    <td class="subtotalColumn ">

                                    </td>
                                    <td class="">

                                    </td>
                                    <td class="totalColumn ">

                                    </td>
                                </tr>
                                <tr id="pesostr" style="display: none;" class="currtr">
                                    <td class="">

                                    </td>
                                    <td class="subtotalColumn ">

                                    </td>
                                    <td class="">

                                    </td>
                                    <td class="totalColumn ">

                                    </td>
                                </tr>
                            <h4 class="col-xs-12 col-sm-12 col-md-12 col-lg-12 ">Productos</h4>
                            <div class="table-responsive col-xs-12 col-sm-12 col-md-12 col-lg-12 ">
                                <table class="table table-striped"id="productsconftable"></table>
                            </div>
                        </div>

                        <div class="tab"  id="paymenttab" class="form-group">
                            <h2>Pago</h2>
                            <h4>Conversión de valores</h4>
                            <div class="form-group col-xs-12 col-sm-12 col-md-6 col-lg-3">
                                <label>Total a pagar</label>
                                <div class="form-control-static">
                                    <div style="float: left;">AR$&nbsp;</div>
                                    <div id="totalAmountPayment" style="float: left;"></div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12  addPaymentControl">
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-2">
                                    <label>Método de pago</label>
                                    <select class="form-control" id="paymentMethod">
                                        <option value="cashP">Efectivo</option>
                                        <option value="transferP">Transferencia</option>
                                        <option value="cardP">Tarjeta</option>
                                    </select>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-2">
                                    <label>Moneda</label>
                                    <select class="form-control" id="paymentCurrency">
                                        <option class="paymentN" value="USD">Dólar</option>
                                        <option class="paymentN" value="BRL">Real</option>
                                        <option class="paymentT" value="BRT" style="display:none">Real transf</option>
                                        <option class="paymentN" value="EUR">Euro</option>
                                        <option class="paymentN" value="ARS">Peso</option>
                                    </select>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label>Monto</label>
                                    <div class=" input-group">
                                        <span class="input-group-addon">$</span>
                                        <input id="paymentAmountToAdd" class="form-control" step="0.1" type="number" min="0">
                                    </div>
                                </div>
                                <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-2">
                                    <button type="button" class="btn btn-success" id="addPaymentRow" onclick="_addPaymentRow(event)">Agregar</button>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 ">
                                <div class="form-group" style="width: 200px;">
                                    <label>Recargo tarjeta</label>
                                    <div class="input-group">
                                        <span class="input-group-addon">%</span>
                                        <input id="cardCharge" class="form-control" value="21" step="1" type="number" name="quantity" min="1" max="100" disabled="">
                                        <span class="input-group-btn">
                                            <button class="btn btn-default" type="button" onclick="_enableEdit(event)"><i class="fa fa-edit"></i></button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive col-xs-8 col-sm-8 col-md-8 col-lg-8">
                                <table class="table table-striped" id="paymentTable">
                                    <thead class="paymentTableHead">
                                        <tr><th>Modalidad</th><th>Moneda</th><th>Subtotal</th><th>Subtotal AR$</th><th>Recargo tarjeta AR$</th><th>Eliminar</th></tr>
                                    </thead>
                                    <tbody class="paymentTableBody">
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 ">
                                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-3 col-lg-offset-3">
                                    <label style="">Total rec. tarj.</label>
                                    <div class="input-group" style="">
                                        <span class="input-group-addon">AR$</span>
                                        <input id="sumCardCharge" class="form-control" value="0" type="number" name="quantity" min="0" disabled="">
                                    </div>
                                </div>
                                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                    <label style="">Faltan pagar</label>
                                    <div class="input-group" style="">
                                        <span class="input-group-addon">AR$</span>
                                        <input id="remainingAmount" class="form-control" value="0" type="number" name="quantity" min="0" disabled="">
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-3">
                                    <label style="">Total con recargo</label>
                                    <div class="input-group" style="">
                                        <span class="input-group-addon">AR$</span>
                                        <input id="totalWithCharges" class="form-control" value="0" type="number" name="quantity" min="0" disabled="">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab" class="form-group">
                            <h2>Venta realizada</h2>
                            <h4>Datos del cliente</h4>
                            <div class="form-group col-xs-12 col-sm-12 col-md-6 col-lg-3">
                                <label>Nombre y Apellido</label>
                                <p class="clientnamelabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                <label>DNI/Pasaporte</label>
                                <p class="passportlabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                <label>Nacionalidad</label>
                                <p class="nationalitylabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                <label>Hotel</label>
                                <p class="hotellabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                <label>Dirección</label>
                                <p class="addresslabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                <label>Habitación</label>
                                <p class="roomlabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                <label>Número de contacto</label>
                                <p class="phonelabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                <label>Email</label>
                                <p class="emaillabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-3">
                                <label>Promotor</label>
                                <p class="promoterlabel form-control-static"></p>
                            </div>
                            <div class="form-group col-xs-12 col-sm-12 col-md-6 col-lg-3">
                                <label>Total</label>
                                <p class="productTotal form-control-static"></p>
                            </div>
                            <h4 class="col-xs-12 col-sm-12 col-md-12 col-lg-12 ">Productos</h4>
                            <div class="table-responsive col-xs-12 col-sm-12 col-md-12 col-lg-12 ">
                                <table class="table table-striped"id="productsfinishtable"></table>
                            </div>
                        </div>


                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 " style="overflow:auto;margin-top: 15px;">
                            <div id="saleActionBtns" style="float:right;">
                                <button type="button" class="btn btn-primary" id="prevBtn" onclick="nextPrev(-1)">Volver</button>
                                <button type="button" class="btn btn-success" id="nextBtn" onclick="nextPrev(1)">Siguiente</button>
                                <button type="button" class="btn btn-primary" id="printVoucherBtn" onclick="_printVoucher()" style="display: none">Imprimir Voucher</button>
                                <button type="button" class="btn btn-primary" id="printReceiptBtn" onclick="_printReceipt()" style="display: none">Imprimir Recibo</button>
                                <button type="button" class="btn btn-primary" id="downloadVoucherBtn" onclick="_downloadVoucher()" style="display: none">Descargar Voucher</button>
                                <button type="button" class="btn btn-primary" id="downloadReceiptBtn" onclick="_downloadReceipt()" style="display: none">Descargar Recibo</button>
                            </div>
                        </div>

                    <!-- Circles which indicates the steps of the form: -->
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 " style="text-align:center;margin-top:40px;">
                            <span class="step"></span>
                            <span class="step"></span>
                            <span class="step"></span>
                            <span class="step"></span>
                            <span class="step"></span>
                        </div>

                    </form>
                </div>
            </div>
            <div class="modal fade" id="noProductsModal" tabindex="-1" role="dialog" aria-labelledby="noProductsModal" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="noProductsModalTitle">No hay productos</h4>
                        </div>
                        <div class="modal-body">
                            No se ha seleccionado ningún producto. Agregue uno para continuar con el siguiente paso.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Entendido</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="invalidExchangeModal" tabindex="-1" role="dialog" aria-labelledby="invalidExchangeModal" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title">Cotización inválida</h4>
                        </div>
                        <div class="modal-body" id="invalidExchangeModalText">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Entendido</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="noPeopleModal" tabindex="-1" role="dialog" aria-labelledby="noPeopleModal" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="noPeopleModalTitle">Error en producto</h4>
                        </div>
                        <div class="modal-body">
                            No se ha seleccionado ninguna persona (adulto, niño, bebé) en al menos uno de los formularios. Agregue al menos uno en cada producto para continuar con el siguiente paso.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Entendido</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="wrongAmountModal" tabindex="-1" role="dialog" aria-labelledby="wrongAmountModal" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="wrongAmountModalTitle">Error en la suma</h4>
                        </div>
                        <div class="modal-body">
                            El "Total a pagar" no es igual a la suma de los subtotales (AR$) de todas las filas seleccionadas. Verifique que el valor de "Faltan pagar" sea cero.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Entendido</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/metisMenu/2.7.9/metisMenu.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/fontenay.js"></script>
    <script>
        $(document).ready(function() {
            _checkLogin();
            $("#date").val(_getCurrentDate()+"T12:00");
            _loadPromoters();
            _loadProducts();
            _loadCurrencies();
            $("#servicesel").change(_productChanged);
            $("#discountcurrencysel").change(_currencyChanged);
            $("#exchangeRate").blur(_validateExchangeRate);
            //$("#discount").blur(_calculateDiscountAmount);
            $("#totalDiscount").blur(_calculateDiscountAmount);
            $("#adults, #children, #babies").change(_peopleChanged);
            $("#paymentMethod").change(_refreshPaymentCurrency);
            $("#paymentCurrency").change(_refreshPaymentAmountToAdd);
            $("#remainingAmount").change(_refreshPaymentAmountToAdd);

            sale = {
                client: {},
                products: [],
                subtotalAR: 0,
                totalStockAR: 0,
                discountCurrency: "",
                customExchangeRate: 0,
                discount: 0,
                totalAR: 0,
                paymentRows: [],
                payments: []
            };
            //DELETE
            $("#nextBtn").focus();
        });

        var currentTab = 0; // Current tab is set to be the first tab (0)
        showTab(currentTab); // Display the current tab

        function showTab(n) {
            // This function will display the specified tab of the form ...
            var x = document.getElementsByClassName("tab");
            x[n].style.display = "block";
            // ... and fix the Previous/Next buttons:
            if (n === 0 || n === 4) {
                document.getElementById("prevBtn").style.display = "none";
            } else {
                document.getElementById("prevBtn").style.display = "inline";
            }

            if (n === (x.length - 2)) {
                document.getElementById("nextBtn").innerHTML = "Confirmar";
            } else {
                document.getElementById("nextBtn").innerHTML = "Siguiente";
            }
            // ... and run a function that displays the correct step indicator:
            fixStepIndicator(n)
        }

        function nextPrev(n) {
            var lastTab = ((currentTab + n) === 4);
            // This function will figure out which tab to display
            var x = document.getElementsByClassName("tab");
            // Exit the function if any field in the current tab is invalid:
            if (n === 1 && !validateForm()) return false;
            if(!lastTab) {
                x[currentTab].style.display = "none";
            }
            currentTab = currentTab + n;
            // if you have reached the end of the form... :
            if (currentTab - 1 >= x.length) {
                return false;
            }
            // Otherwise, display the correct tab:
            if(currentTab === 1)
                loadProductsTab();
            else if(currentTab === 2)
                loadConfirmationTab();
            else if (currentTab === 3) {
                loadPaymentTab();
            } else if (lastTab) {
                loadFinishTab();
                _parseSale();
                _createClient(sale);
                $("#wrapper").addClass("mask");
            }

            if(!lastTab) {
                showTab(currentTab);
            }
        }

        function validateForm() {
            // This function deals with validation of the form fields
            var x, y, i, valid = true, productsList = true, peopleNumber = true, remainingAmount = true;
            x = document.getElementsByClassName("tab");
            y = x[currentTab].getElementsByTagName("input");
            // A loop that checks every input field in the current tab:
            for (i = 0; i < y.length; i++) {
                // If a field is empty...
                var elem = $(y[i]);
                elem.removeClass("invalid").parent().removeClass("has-error");
                if ("" === elem[0].value && !elem.hasClass("no-required")) {
                    // add an "invalid" class to the field:
                    elem.addClass("invalid").parent().addClass("has-error");
                    // and set the current valid status to false:
                    valid = false;
                } else if(1 === currentTab && (y.length === (i+1))) {
                    var totalPeople = _numberOfPeople(elem.closest(".productPanel"));
                    if(totalPeople <= 0) {
                        $('#noPeopleModal').modal('show');
                        peopleNumber = false;
                    }
                } else if(2 === currentTab) {
                    var inpTot = $("#totalDiscount");
                    if(Number(inpTot.val()) <= 0) {
                        inpTot.addClass("invalid").parent().addClass("has-error");
                        valid = false;
                    }
                } else if(3 === currentTab) {
                    var value = Math.abs(Number($("#remainingAmount").val()));
                    if(value > 1) {
                        $('#wrongAmountModal').modal('show');
                        remainingAmount = false;
                    } else if (value > 0) {
                        if(undefined === sale.paymentRows["cashPARS"]) {
                            _addPayment("cashPARS", value, value, 0, 1, "Redondeo ARS");
                        } else {
                            _updateARSPayment(value);
                        }
                    }
                }
            }

            if(1 === currentTab && $(".productPanel").length < 1) {
                $('#noProductsModal').modal('show');
                productsList = false;
            }
            // If the valid status is true, mark the step as finished and valid:
            if (valid && productsList && peopleNumber) {
                document.getElementsByClassName("step")[currentTab].className += " finish";
            }
            return valid && productsList && peopleNumber && remainingAmount; // return the valid status
        }

        function fixStepIndicator(n) {
            // This function removes the "active" class of all steps...
            var i, x = document.getElementsByClassName("step");
            for (i = 0; i < x.length; i++) {
                x[i].className = x[i].className.replace(" active", "");
            }
            //... and adds the "active" class to the current step:
            x[n].className += " active";
        }

        function loadProductsTab() {
            sale.client = {
                name: $("#clientname").val(),
                email: $("#email").val(),
                nationality: $("#nationality").val(),
                hotel: $("#hotel").val(),
                address: $("#address").val(),
                room_number: $("#room").val(),
                passport_number: $("#passport").val(),
                contact_number: $("#phonenumber").val()
            };
            sale.promoter = _findPromoter($("#promotersel").val());
        }

        function loadConfirmationTab() {
            loadTabLabels();
            sale.products = _loadSaleProducts();
            _calculateProductsSubtotal(sale);
            $(".productTotal").text(sale.subtotalAR);
            loadProductsTable(3);
            _currencyChanged();
        }

        function loadPaymentTab() {
            var discountCurrencySel = $("#discountcurrencysel");
            var discInput = $("#discount");
            sale.discountCurrency = discountCurrencySel.find("option:selected").attr("curr");
            var exchInput = $("#exchangeRate");
            var customExcRate = Number(exchInput.val());
            var excRate = _getExchangeRate(sale.discountCurrency);
            sale.totalAR = sale.subtotalAR; //Find total en pesos sin modificar
            $(".paymentTableBody").empty();
            $("#paymentAmountToAdd").val(0);
            sale.paymentRows = [];

            if(customExcRate !== excRate) {
                excRate = customExcRate;
            }

            sale.customExchangeRate = excRate;
            sale.discount = Number(discInput.val() * sale.customExchangeRate);

            if(sale.discount > 0) {
                sale.totalAR -= sale.discount;
            }

            var possiblyGreaterTotal = Number($("#totalDiscount").val())*excRate;

            if(possiblyGreaterTotal > sale.totalAR)
                sale.totalAR = Number(possiblyGreaterTotal.toFixed(2));
            else
                sale.totalAR = Number((Math.round(sale.totalAR * 100)/100).toFixed(2));

            $("#totalAmountPayment").text(sale.totalAR);
            $("#remainingAmount").val(sale.totalAR).trigger("change");
            $("#totalWithCharges").val(sale.totalAR);
            $("#paymentCurrency").val(sale.discountCurrency);
            if(sale.discountCurrency === "BRT") {
                $("#paymentMethod").val("transferP");
                _refreshPaymentCurrency();
            }
            var pymntAmtToAdd = Number($("#totalDiscount").val());
            if(sale.totalAR < pymntAmtToAdd*sale.customExchangeRate)
                pymntAmtToAdd -= 0.01;

            $("#paymentAmountToAdd").val(pymntAmtToAdd.toFixed(2));
        }

        function loadFinishTab() {
            sale.total_card_charges = Number($("#remainingAmount").val());
            var total = sale.totalAR + sale.total_card_charges;
            $(".productTotal").text("ARS " + total);
            loadProductsTable(5);
            _enablePrintBtns();
        }

        function _loadPromotersHandler(result) {
            var promSel = $("#promotersel");
            _loadUserSelect(result, promSel);
        }

        function _loadProducts() {
            var productsPromise = new Promise(
                function (resolve, reject) {
                    _getProducts(resolve, reject);
                }
            );

            var load = function(productsPromise) {
                productsPromise
                    .then(function (result) {
                        _loadProviders();
                    })
                    .catch(function (error) {
                        console.log(error.message);
                    });
            };
            load(productsPromise);
        }

        function _loadProvidersHandler(result) {
            _refreshProvidersSelect($("#providerSel"));
            _loadProductsSelect();
        }

        function _refreshProvidersSelect(select) {
            var provSel = select ? select : $("#providerSel");
            Models["providers"].filter(function(p) { return !p.deleted}).forEach(function(element, index){
                var opt = $(document.createElement("option"));
                opt.text(element.name);
                opt.attr("value", element.provider_id);
                provSel.append(opt);
            });
            provSel.change(_providerChanged);
        }

        function _loadProductsSelect() {
            _refreshProductsSelect($("#providerSel option:selected").val());
        }

        function _providerChanged(event) {
            var currT = $(event.currentTarget);
            var servSel = currT.closest(".productPanel").find("#servicesel");
            servSel.empty();
            _refreshProductsSelect(parseInt(currT.val()),servSel);
        }

        function _productChanged(event) {
            var currP = $(event.currentTarget);
            _updatePrice(parseInt(currP.val()), currP);
        }

        function _currencyChanged() {
            var curr = $("#discountcurrencysel").find("option:selected").attr("curr");
            loadCurrencyValue(curr);
            _changeCurrencySpan(curr);
            _calculateSubtotalAmount();
        }

        function _changeCurrencySpan(curr) {
            var text = "";
            switch(curr) {
                case "USD":
                    text = "US$";
                    break;
                case "BRL":
                    text = "R$";
                    break;
                case "BRT":
                    text = "RT$";
                    break;
                case "EUR":
                    text = "€";
                    break;
                case "ARS":
                    text = "AR$";
                    break;
                default:
                    text = "ERROR";
            }
            $("#subtotalDiscountLabel").text(text);
            $("#discountLabel").text(text);
            $("#totalDiscountLabel").text(text);
        }

        function _validateExchangeRate(e) {
            var exchRateInp = $("#exchangeRate");
            var min = Number(exchRateInp.attr("min"));
            var max = Number(exchRateInp.attr("max"));
            var val = Number(exchRateInp.val());
            if(val >= min && val <= max) {
                _calculateSubtotalAmount();
            } else {
                val = min === max ? 1 : min + 0.5;
                exchRateInp.val(val);
                $('#invalidExchangeModal').modal('show');
                $('#invalidExchangeModalText').empty().text("Los valores válidos para esta cotización varian entre AR$ "
                + min + " y AR$ "+ max +
                ", y dependen del valor configurado en el sistema (AR$ "+ val +"). Contacte al administrador para modificar estos valores.");
            }
        }

        function _calculateSubtotalAmount() {
            var curr = $("#discountcurrencysel").find("option:selected").attr("curr");
            if(curr === "ARS") {
                $("#exchangeRate").val(1);
            }
            _calculateSubtotal();
            _calculateDiscountAmount();
        }

        function _calculateDiscountAmount() {
            var discountColor;
            var borderWidth = 1;
            var totalDiscount = Number($("#totalDiscount").val());
            var subtotal = Number($("#subtotalDiscount").val());
            totalDiscount = totalDiscount ? totalDiscount : subtotal;
            var discount = Number((subtotal - totalDiscount).toFixed(2));
            if(discount > 0) {
                discountColor = "red;";
                borderWidth = 3;
            } else if(discount === 0) {
                discountColor = "rgb(204, 204, 204);";
                borderWidth = 1;
            } else {
                discountColor = "green;";
                borderWidth = 3;
            }
            $("#discount").val(discount).attr("style", "border-width: " + borderWidth + "px; border-color: " + discountColor);
        }


        function _peopleChanged(event) {
            var currP = $(event.target).closest(".productPanel").find("#servicesel");
            _updatePrice(parseInt(currP.val()), currP);
        }

        function _refreshPaymentAmountToAdd(e) {
            var currency = $("#paymentCurrency").val();
            var exchRate = _getExchangeRate(currency);
            if(sale.discountCurrency === currency) {
                exchRate = sale.customExchangeRate;
            }

            var pymntAmtToAdd = Number((Number($("#remainingAmount").val()) / exchRate).toFixed(2));
            if(sale.totalAR < pymntAmtToAdd*sale.customExchangeRate)
                pymntAmtToAdd -= 0.01;

            $("#paymentAmountToAdd").val(pymntAmtToAdd.toFixed(2));
        }

        function _refreshPaymentCurrency(e) {
            var method = $("#paymentMethod").val();
            if("transferP" === method) {
                $(".paymentT").show();
                $(".paymentN").hide();
                $("#paymentCurrency").val("BRT");
            } else {
                $(".paymentT").hide();
                $(".paymentN").show();
                var curr = $("#paymentCurrency").val();
                if(curr === "BRT")
                    $("#paymentCurrency").val("USD");
            }
            _refreshPaymentAmountToAdd();
        }

        function _updatePrice(productID, select) {
            var prod = Models["products"].find(function(element){
                if(element.product_id === productID)
                    return element;
            });

            var prodPanel = select.closest(".productPanel");
            var prodPrice = prodPanel.find("#uprice");
            var stockPrice = prodPanel.find("#stockprice");

            var numberAdults = parseInt(prodPanel.find("#adults").val());
            var numberChildren = parseInt(prodPanel.find("#children").val());
            var numberBabies = parseInt(prodPanel.find("#babies").val());

            prodPrice.val(prod.selling_price_adult*numberAdults + prod.selling_price_child*numberChildren + prod.selling_price_baby*numberBabies);
            stockPrice.val(prod.stock_price_adult*numberAdults + prod.stock_price_child*numberChildren + prod.stock_price_baby*numberBabies);
        }

        function _numberOfPeople(panel) {
            var numberAdults = parseInt(panel.find("#adults").val());
            var numberChildren= parseInt(panel.find("#children").val());
            var numberBabies = parseInt(panel.find("#babies").val());
            return numberAdults + numberChildren + numberBabies;
        }

        function _refreshProductsSelect(providerID, select) {
            var prodSel = select ? select : $("#servicesel");
            Models["products"].filter(function(e) {
                   return e.provider.provider_id === Number(providerID) && !e.deleted;
                })
                .forEach(function(element){
                    var opt = $(document.createElement("option"));
                    opt.text(element.name);
                    opt.attr("value",element.product_id);
                    prodSel.append(opt);
            });
            _updatePrice(parseInt(prodSel.val()), prodSel);
        }

        function loadTabLabels() {
            $(".clientnamelabel").text(sale.client.name);
            $(".passportlabel").text(sale.client.passport_number);
            $(".nationalitylabel").text(sale.client.nationality);
            $(".hotellabel").text(sale.client.hotel);
            $(".addresslabel").text(sale.client.address);
            $(".roomlabel").text(sale.client.room_number);
            $(".phonelabel").text(sale.client.contact_number);
            $(".emaillabel").text(sale.client.email);
            $(".promoterlabel").text(sale.promoter.first_name + " " + sale.promoter.last_name);
        }

        function _enablePrintBtns() {
            $("#prevBtn").hide();
            $("#nextBtn").hide();
            $("#printVoucherBtn").show();
            $("#printReceiptBtn").show();
            $("#downloadVoucherBtn").show();
            $("#downloadReceiptBtn").show();
        }

        function _printVoucher() {
            var win = window.open("voucher.html?saleid=" + sale.success.sale_id, "_blank");
            win.focus();
        }

        function _printReceipt() {
            var win = window.open("receipt.html?saleid=" + sale.success.sale_id, "_blank");
            win.focus();
        }

        function _downloadVoucher() {
            var win = window.open("voucher.html?saleid=" + sale.success.sale_id+"&download=true", "_blank");
            win.focus();
        }

        function _downloadReceipt() {
            var win = window.open("receipt.html?saleid=" + sale.success.sale_id+"&download=true", "_blank");
            win.focus();
        }

        function getCustomExchangeRates(currency) {
            var exchRate = _getExchangeRate(currency);
            return sale.discountCurrency === currency && sale.customExchangeRate !== exchRate ? sale.customExchangeRate : exchRate;
        }

        function loadCurrencyValue(curr) {
            var min = 1;
            var max = 1;
            var defaultExchRate = 1;
            var customExchRate = 1;
            if("ARS" !== curr) {
                defaultExchRate = _getExchangeRate(curr);
                customExchRate = getCustomExchangeRates(curr);
                min = defaultExchRate - 0.5;
                max = defaultExchRate + 1;
            }
            $("#exchangeRate").val(customExchRate).attr({
                "max" : max,
                "min" : min
            });
        }

        function _calculateSubtotal() {
            var subTotal = sale.subtotalAR ;
            var rate = Number($("#exchangeRate").val());
            $("#subtotalDiscount").val((subTotal/rate).toFixed(2));
        }

        function loadProductsTable(order) {
            var prodTable;
            if(order === 3) {
                prodTable = $("#productsconftable");
            } else {
                prodTable = $("#productsfinishtable");
            }

            prodTable.empty();
            loadProdTableHeader(prodTable, order);

            sale.products.forEach(function(el){
                loadProdTableRow(el, order);
            });
        }

        function loadProdTableHeader(prodTable, o) {
            var th1 = $(document.createElement("th")).text("Proveedor");
            var th2 = $(document.createElement("th")).text("Servicio");
            var th3 = $(document.createElement("th")).text("Fecha/Hora pick-up (Si aplica)");
            var th4 = $(document.createElement("th")).text("Traslado");
            var th5 = $(document.createElement("th")).text("Adulto(s)");
            var th6 = $(document.createElement("th")).text("Niños(s)");
            var th7 = $(document.createElement("th")).text("Bebé(s)");
            var th8 = $(document.createElement("th")).text("Subtotal producto");
            var tr1 = $(document.createElement("tr")).append(th1).append(th2).append(th3).append(th4).append(th5).append(th6).append(th7).append(th8);
            var thd1 = $(document.createElement("thead")).append(tr1);
            var clss = o === 3? "productConfTableBody" : "productFinishTableBody";
            var tbody = $(document.createElement("tbody")).addClass(clss);
            prodTable.append(thd1).append(tbody);
        }

        function loadProdTableRow(product, o) {
            var td1 = $(document.createElement("td")).addClass("increaseWidth").text(product.product.provider.name);
            var td2 = $(document.createElement("td")).addClass("increaseWidth").text(product.product.name);
            var td3 = $(document.createElement("td")).addClass("increaseWidth").text(_getFormatDateDDMMYYYYHHMM(new Date(product.date)));
            var td4 = $(document.createElement("td")).text(product.transfer ? "Sí" : "No");
            var td5 = $(document.createElement("td")).text(product.adults);
            var td6 = $(document.createElement("td")).text(product.children);
            var td7 = $(document.createElement("td")).text(product.babies);
            var td8 = $(document.createElement("td")).addClass("increaseWidth").text(product.price);
            var tr1 = $(document.createElement("tr")).append(td1).append(td2).append(td3).append(td4).append(td5).append(td6).append(td7).append(td8);
            var clss = o === 3? ".productConfTableBody" : ".productFinishTableBody";
            $(clss).append(tr1);
        }

        $(".deleteProduct").click(_deleteProductPanel);

        function _deleteProductPanel(e) {
            $(e.target).closest(".productPanel").remove();
        }

        $("#addProduct").click(function(){
            //var = $("#listOfProducts").children().length;
            var container = $("#listOfProducts");

            var panelContainer = $(document.createElement('div')).addClass("col-xs-12 col-sm-12 col-md-6 col-lg-4 productPanel").attr("id","randomtimestamp");
            var panel = $(document.createElement('div')).addClass("panel panel-default");
            var panelHeader = $(document.createElement('div')).addClass("panel-heading").text("Producto");
            var deleteButton = $(document.createElement('button')).attr("type","button").addClass("close deleteProduct").text("×").click(_deleteProductPanel);
            var panelBody = $(document.createElement('div')).addClass("panel-body");
            var lbl1 = $(document.createElement('label')).text("Proveedor");
            var sel1 = $(document.createElement('select')).addClass("form-control").attr("id","providerSel");
            var lbl2 = $(document.createElement('label')).text("Servicio");
            var sel2 = $(document.createElement('select')).addClass("form-control").attr("id","servicesel");
            var lbl3 = $(document.createElement('label')).text("Fecha/Hora pick-up (Si aplica)");
            var fec3 = $(document.createElement('input')).addClass("form-control").attr("type","datetime-local").attr("id","date").attr("step","300").val(_getCurrentDate()+"T12:00");
            var lbl4 = $(document.createElement('label')).text("Traslado");
            var sel4 = $(document.createElement('select')).addClass("form-control").attr("id","transfersel");
            var op41 = $(document.createElement('option')).text("Si").attr("value",true);
            var op42 = $(document.createElement('option')).text("No").attr("value",false);
            var lbl5 = $(document.createElement('label')).text("Adulto(s)");
            var inp5 = $(document.createElement('input')).addClass("form-control").attr("type","number").attr("id","adults").attr("value","2").attr("min","0");
            var lbl6 = $(document.createElement('label')).text("Niño(s)");
            var inp6 = $(document.createElement('input')).addClass("form-control").attr("type","number").attr("id","children").attr("value","0").attr("min","0");
            var lbl7 = $(document.createElement('label')).text("Bebé(s)");
            var inp7 = $(document.createElement('input')).addClass("form-control").attr("type","number").attr("id","babies").attr("value","0").attr("min","0");
            var lbl8 = $(document.createElement('label')).text("Subtotal producto");
            var spn81 = $(document.createElement('span')).addClass("input-group-addon").text("$");
            var spn82 = $(document.createElement('span')).addClass("input-group-addon").text(".00");
            var ig8 = $(document.createElement('div')).addClass("input-group");
            var inp8 = $(document.createElement('input')).addClass("form-control").attr("type","number").attr("id","uprice").attr("disabled","disabled");
            var inp9 = $(document.createElement('input')).addClass("form-control").attr("type","number").attr("id","stockprice").css("display","none");

            var for1 = $(document.createElement('div')).addClass("form-group");
            var for2 = $(document.createElement('div')).addClass("form-group");
            var for3 = $(document.createElement('div')).addClass("form-group");
            var for4 = $(document.createElement('div')).addClass("form-group");
            var for5 = $(document.createElement('div')).addClass("form-group");
            var for6 = $(document.createElement('div')).addClass("form-group");
            var for7 = $(document.createElement('div')).addClass("form-group");
            var for8 = $(document.createElement('div')).addClass("form-group");

            panelHeader.append(deleteButton);
            sel4.append(op41).append(op42);

            for1.append(lbl1).append(sel1);
            for2.append(lbl2).append(sel2);
            for3.append(lbl3).append(fec3);
            for4.append(lbl4).append(sel4);
            for5.append(lbl5).append(inp5);
            for6.append(lbl6).append(inp6);
            for7.append(lbl7).append(inp7);
            ig8.append(spn81).append(inp8).append(spn82);
            for8.append(lbl8).append(ig8);
            panelBody.append(for1).append(for2).append(for3).append(for4).append(for5).append(for6).append(for7).append(for8).append(inp9);
            panel.append(panelHeader).append(panelBody);
            panelContainer.append(panel);
            container.append(panelContainer);
            _refreshProvidersSelect(sel1);
            _refreshProductsSelect(Number(sel1.val()),sel2);
            sel2.change(_productChanged);
            inp5.change(_peopleChanged);
            inp6.change(_peopleChanged);
            inp7.change(_peopleChanged);
        });

        function _addPaymentRow(e) {
            _removeBorders();
            var elem = $(".addPaymentControl");
            var paymentMethodOpt = elem.find("#paymentMethod option:selected");
            var paymentCurrencyOpt = elem.find("#paymentCurrency option:selected");
            var paymentAmountToAdd = elem.find("#paymentAmountToAdd").val();
            var cardChargePercentage = Number((Number($("#cardCharge").val())/100).toFixed(2));
            var currency = paymentCurrencyOpt.val();
            var id = paymentMethodOpt.val() + currency;
            var exchRate = _getExchangeRate(currency);
            var cardCharge = 0;

            if(sale.discountCurrency === currency) {
                exchRate = sale.customExchangeRate;
            }

            if(paymentMethodOpt.val() === "cardP") {
                cardCharge = (Number(Number(paymentAmountToAdd) * exchRate * cardChargePercentage).toFixed(2));
            }

            var paymentAmountARSToAdd = (Number(Number(paymentAmountToAdd) * exchRate).toFixed(2));

            if(_addPayment(id, paymentAmountToAdd, paymentAmountARSToAdd, cardCharge, exchRate, "")) {
                var td1 = $(document.createElement("td")).text(paymentMethodOpt.text());
                var td2 = $(document.createElement("td")).text(paymentCurrencyOpt.text());
                var td3 = $(document.createElement("td")).text(paymentAmountToAdd);
                var td4 = $(document.createElement("td")).addClass("totalARRow").text(paymentAmountARSToAdd);
                var td5 = $(document.createElement("td")).text(cardCharge);
                var i   = $(document.createElement("i")).addClass("fa fa-trash-o");
                var btn = $(document.createElement("button")).attr("type","button").addClass("btn btn-danger btn-circle").append(i);
                var td6 = $(document.createElement("td")).append(btn);
                var tr1 = $(document.createElement("tr")).attr("id",id).addClass("paymentRow").append(td1).append(td2).append(td3).append(td4).append(td5).append(td6);
                $(".paymentTableBody").append(tr1);
                $(btn).click(function(){
                    _removePayment(id);
                    $(btn).closest(".paymentRow").remove();
                });
            } else {
            }

            $("#paymentMethod").val("cashP");
            $("#paymentCurrency").val("ARS");
        }

        function _addPayment(id, val, arVal, cardCharge, exchRate, description) {
            var status = false;
            if(!sale.paymentRows[id] || sale.paymentRows[id].length < 2) {
                status = _calculateRemainingAmount(arVal);
            } else {
                $("#"+id).css("border","3px solid red");
                alert("- El método de pago y la moneda seleccionada ya fueron agregados. Borre el registro existente e intente nuevamente.");
            }
            if(status) {
                sale.paymentRows[id] = [val, arVal, cardCharge, exchRate, description];
                _calculateTotalCardCharge();
                _calculateTotalWithCharge();
            }
            return status;
        }

        function _removePayment(id) {
            _removeBorders();
            delete sale.paymentRows[id];
            _calculateRemainingAmount(0);
            _calculateTotalCardCharge();
            _calculateTotalWithCharge();
        }

        function _updateARSPayment(value) {
            var cashPARS = sale.paymentRows["cashPARS"];
            var oldValue = Number(cashPARS[1]);
            _removePayment("cashPARS");
            _addPayment("cashPARS",oldValue + value, oldValue + value, 0, 1, "")
        }


        function _removeBorders() {
            $(".paymentRow").css("border","none");
        }

        function _calculateRemainingAmount(arAmount) {
            var status = false;
            var remainingAmount = sale.totalAR;
            for (const key in sale.paymentRows) {
                remainingAmount -= Number(Number(sale.paymentRows[key][1] ? Number(sale.paymentRows[key][1]) : 0).toFixed(2));
            }
            remainingAmount = Number((remainingAmount - arAmount).toFixed(2));
            if(remainingAmount >= 0) {
                $("#remainingAmount").val(remainingAmount).trigger("change");
                status = true;
            } else {
                alert("- La suma total no puede ser mayor que el total a pagar.");
            }
            return status;
        }

        function _calculateTotalCardCharge() {
            var totalCardCharge = 0;
            for (const key in sale.paymentRows) {
                totalCardCharge += Number(Number(sale.paymentRows[key][2] ? Number(sale.paymentRows[key][2]) : 0).toFixed(2));
            }
            $("#sumCardCharge").val(totalCardCharge);
        }

        function _calculateTotalWithCharge() {
            var totalWithCharges = Number((Number($("#sumCardCharge").val()) + sale.totalAR - Number($("#remainingAmount").val())).toFixed(2));
            $("#totalWithCharges").val(totalWithCharges);
        }

        function _parseSale() {
            var prodList = [];
            for (const key in sale.paymentRows) {
                var currStr = key.slice(key.length-3,key.length);
                var method = key.slice(0,key.length-4);
                var roundText = sale.paymentRows[key][4];
                var desc = roundText === "" ? "Venta cli: " + sale.client.name + " " + currStr : "Venta cli: " + sale.client.name + " " + roundText;
                sale.payments.push({
                    "method": method,
                    "currency_id": _getCurrencyID(currStr),
                    "amount": Number(sale.paymentRows[key][0]),
                    "exchange": sale.paymentRows[key][3],
                    "description": desc
                });
            }
            sale.detailedProducts = sale.products;
            sale.products.forEach(function(e){
                e.date = e.date.replace("T"," ");
                prodList.push(e.product);
            });
            //sale.products = prodList;
        }

        function _loadCurrenciesHandler(result) {
        }
    </script>
</body>

</html>
